<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Phoebe.js by example</title>

    <link href="./phoebe.css" rel="stylesheet">

    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.11.1/build/styles/atom-one-dark.min.css">
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.11.1/build/highlight.min.js"></script>

    <style>
        body {
            background-color: #ccc;
            color: #333;
            font-family: sans-serif;

            background-image:
                radial-gradient(circle at 30% 30%, #c8c8c8 20%, transparent 21%),
                radial-gradient(circle at 70% 70%, #cfcfcf 20%, transparent 21%);
            background-size: 15px 15px;
            background-repeat: repeat;
        }

        main {
            max-width: 80rem;
            margin: 0 auto;
        }

        details {
            margin: 1rem;
            padding: 1rem;
            background-color: #fff;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        }

        details[open]>summary {
            margin-bottom: 1rem;
        }

        details>summary {
            cursor: pointer;
            font-weight: bold;
        }

        details>*:not(summary) {
            margin: 1rem;
        }

        code.phoebe-html {
            display: block;
            font-family: sans-serif;
            border: 1px solid #282c34;
            margin-bottom: 1rem;
            padding: 1rem;
        }
    </style>
</head>

<body>

    <header style="display: flex; align-items: center;justify-content: center; gap:1rem">
        <img src="logo.png" style="width: 5rem;" alt="Phoebe.js Logo" />
        <h1>Phoebe.js by example</h1>
    </header>

    <main>

        <details>
            <summary>Text input binding & templating</summary>

            <code class="phoebe-html">
                <label>
                    Enter the name of your cat:
                    <input type="text" phoebe-bind="name">
                </label>

                <phoebe-text>Hello ${name.toUpperCase()} ðŸ˜º</phoebe-text>
            </code>

            <pre class="phoebe-javascript">
                Phoebe({
                    name: '',
                })
            </pre>
        </details>

        <details>
            <summary>Conditions (if)</summary>

            <code class="phoebe-html">
                <label>
                    Enter the age of your cat:
                    <input type="number" min="0" phoebe-bind="age">
                </label>

                <phoebe-if if="!Number.isFinite(age)">
                    Please enter a valid cat age!
                </phoebe-if>
                <phoebe-if if="Number.isFinite(age)">
                    <div style="font-size: large; color:magenta">
                        <phoebe-text>ðŸŽ‚ ${age} ðŸŽ‰</phoebe-text>
                    </div>
                </phoebe-if>
            </code>

            <pre class="phoebe-javascript">
                Phoebe({
                    age: null,
                })
            </pre>
        </details>

        <details>
            <summary>Events</summary>

            <code class="phoebe-html">
                <button phoebe:onclick="count++">
                    <phoebe-text>Clicked ${count} times</phoebe-text>
                </button>

                <phoebe-if if="count>0">
                    <button phoebe:onclick="count = 0">reset</button>
                </phoebe-if>
            </code>

            <pre class="phoebe-javascript">
                Phoebe({
                    count: 0,
                })
            </pre>
        </details>

        <details>
            <summary>Attributes</summary>

            <code class="phoebe-html">
                <input type="range" min="0" max="100" phoebe-bind="catFullness">

                <output phoebe:style="`color: ${catFullness < 50 ? 'red' : 'green'}`">
                    <phoebe-text>catFullness=${catFullness}%</phoebe-text>
                </output>

                <label>
                    Cat hunger:
                    <meter min="0" max="100" phoebe:value="100 - catFullness"></meter>
                </label>
            </code>

            <pre class="phoebe-javascript">
                Phoebe({
                    catFullness: 0,
                })
            </pre>
        </details>

        <details>
            <summary>Basic Loops (for)</summary>

            <code class="phoebe-html">
                <ol>
                    <phoebe-for var="catName" in="catNames">
                        <li>
                            <phoebe-text>${catName}</phoebe-text>
                        </li>
                    </phoebe-for>
                </ol>

                <hr>

                <label>Search a cat:
                    <input type="text" list="cats-datalist" />
                    (autocomplete)
                    <datalist id="cats-datalist">
                        <phoebe-for var="catName" in="catNames">
                            <option phoebe:value="catName"></option>
                        </phoebe-for>
                    </datalist>
                </label>
            </code>

            <pre class="phoebe-javascript">
                Phoebe({
                    catNames: Object.freeze(['Phoebe', 'Kitty', 'Ruby', 'Kali'])  // readonly list
                })
            </pre>
        </details>

        <details>
            <summary>Radio and checkbox group inputs</summary>

            <code class="phoebe-html">
                <fieldset>
                    <phoebe-for var="catName" in="catNames">
                        <label>
                            <input type="radio" phoebe-bind="selectedCatName" phoebe:value="catName" />
                            <phoebe-text>${catName}</phoebe-text>
                        </label>
                    </phoebe-for>
                </fieldset>
                <phoebe-text>${JSON.stringify({selectedCatName})}</phoebe-text>

                <hr>

                <fieldset>
                    <phoebe-for var="catName" in="catNames">
                        <label>
                            <input type="checkbox" phoebe-bind="selectedCatNames" phoebe:value="catName" />
                            <phoebe-text>${catName}</phoebe-text>
                        </label>
                    </phoebe-for>
                </fieldset>
                <phoebe-text>${JSON.stringify({selectedCatNames})}</phoebe-text>
            </code>

            <pre class="phoebe-javascript">
                Phoebe({
                    catNames: Object.freeze(['Phoebe', 'Kitty', 'Ruby', 'Kali']),  // readonly list
                    selectedCatName: null,  // radio button value
                    selectedCatNames: [],  // checkboxes values
                })
            </pre>
        </details>

        <details>
            <summary>Element references</summary>

            <code class="phoebe-html">
                <input type="text" phoebe-ref="inputEl" />
                <button type="button" phoebe:onclick="inputEl.focus()">
                    focus input
                </button>

                <hr>

                <dialog phoebe-ref="dialogEl">
                    Hello from the dialog!
                    <form method="dialog">
                        <button type="submit">Close</button>
                    </form>
                </dialog>

                <button type="button" phoebe:onclick="dialogEl.showModal()">
                    open dialog
                </button>
            </code>

            <pre class="phoebe-javascript">
                Phoebe({
                    inputEl: undefined,
                    dialogEl: undefined,
                })
            </pre>
        </details>

        <details>
            <summary>Timer</summary>

            <code class="phoebe-html">
                <input type="number" phoebe-bind="countdown.value" phoebe:disabled="countdown.running" min="0"
                    style="font-size: large;" />

                <label>
                    <input type="checkbox" phoebe-bind="countdown.running" phoebe:disabled="countdown.value===0" />
                    <phoebe-text>${countdown.running ? 'Stop' : 'Start'}</phoebe-text>
                </label>

                <phoebe-if if="countdown.running && countdown.value > 0">
                    <phoebe-timer every="1s"
                        do="countdown.value--; if(countdown.value===0) countdown.running = false"></phoebe-timer>
                </phoebe-if>
            </code>

            <pre class="phoebe-javascript">
                Phoebe({
                    countdown: { running: false, value: 10 }
                })
            </pre>
        </details>
    </main>

    <script type="module">
        import Phoebe from './phoebe.js'

        function dedent(str, keepIndent = 0) {
            // Split into lines
            const lines = str.split('\n')

            // Find smallest indentation (ignore empty lines)
            const indents = lines
                .filter(line => line.trim().length > 0)
                .map(line => line.match(/^(\s*)/)[0].length - keepIndent)

            const minIndent = Math.min(...indents)

            // Remove that many spaces from the start of each line
            return lines.map(line => line.slice(minIndent)).join('\n')
        }

        function unescapeHtml(text) {
            return text.replaceAll('&gt;', '>').replaceAll('&lt;', '<').replaceAll('&amp;', '&').replace(/^\s*\r?\n/, '')
        }

        document.querySelectorAll('details').forEach(details => {
            const phoebeHtml = details.querySelector('.phoebe-html')
            const codeBoxHtml = document.createElement('pre')
            const codeElemHtml = document.createElement('code')
            codeElemHtml.classList.add('language-phoebe')
            codeElemHtml.textContent = dedent(unescapeHtml(phoebeHtml.innerHTML))
            codeBoxHtml.appendChild(codeElemHtml)
            details.insertBefore(codeBoxHtml, phoebeHtml.nextSibling)

            const phoebeJavascript = details.querySelector('.phoebe-javascript')
            if (!phoebeJavascript) return
            const codeBoxJs = document.createElement('pre')
            const codeElemJs = document.createElement('code')
            codeElemJs.classList.add('language-javascript')
            codeElemJs.textContent = '<script>\n' + dedent(unescapeHtml(phoebeJavascript.innerHTML), 4) + '<\/script>'
            codeBoxJs.appendChild(codeElemJs)
            details.insertBefore(codeBoxJs, phoebeJavascript.nextSibling)
            phoebeJavascript.hidden = true
        })

        window.phoebe = Phoebe({
            name: '',
            age: null,
            count: 0,
            catFullness: 0,
            inputEl: undefined,
            dialogEl: undefined,
            catNames: Object.freeze(['Phoebe', 'Kitty', 'Ruby', 'Kali']),
            selectedCatName: null,
            selectedCatNames: [],
            countdown: { running: false, value: 10 }
        })

        hljs.registerLanguage('phoebe', function (hljs) {
            return {
                name: 'Phoebe',
                case_insensitive: true,
                contains: [
                    // tags
                    {
                        begin: /\bphoebe-(text|if|for|timer|with|component)\b/,
                        scope: 'keyword'
                    },
                    // phoebe:attr="..."
                    {
                        begin: /\b(phoebe:\w+)\s*=\s*"/,
                        end: /"/,
                        subLanguage: 'javascript'
                    },
                    // <phoebe-text>
                    {
                        scope: 'template-variable',
                        begin: /\$\{/,
                        end: /\}/,
                        subLanguage: 'javascript'
                    },
                    // phoebe-bind="...", phoebe-ref="..."
                    {
                        scope: 'template-variable',
                        begin: /\bphoebe-(bind|ref)="/,
                        end: /"/,
                        subLanguage: 'javascript'
                    },
                    // <phoebe-if>
                    {
                        scope: 'template-variable',
                        begin: /\bif="/,
                        end: /"/,
                        subLanguage: 'javascript'
                    },
                    // <phoebe-for>
                    {
                        scope: 'template-variable',
                        begin: /\bvar="/,
                        end: /"/,
                        subLanguage: 'javascript'
                    },
                    {
                        scope: 'template-variable',
                        begin: /\bin="/,
                        end: /"/,
                        subLanguage: 'javascript'
                    },
                    // <phoebe-timer>
                    {
                        scope: 'template-variable',
                        begin: /\bdo="/,
                        end: /"/,
                        subLanguage: 'javascript'
                    },
                ]
            }
        })
        hljs.highlightAll()
    </script>
</body>

</html>